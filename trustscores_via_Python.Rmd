---
title: "Trust Scores in R"
author: "Sarah Gillespie"
output: html_document
---

## Before we begin...

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(eval = FALSE)

```

```{r libraries}

library(reticulate) # provides a comprehensive set of tools for interoperability between Python and R.

```

```{r}
# configure python
reticulate::py_config() # Double check that reticulate is actually using your new conda env.
reticulate::py_install("sklearn", pip = TRUE) # force install with pip. sklearn wasn't coming up via anaconda.
reticulate::py_install("matplotlib")
reticulate::py_install("keras")

# setting up the Python environment and bringing in the required Python packages is important.
# It will probably take a little while so be patient and try to avoid accidentally running
# this chunk of code.

# common trouble shooting:
# if you're missing a package then try adding its name in an additonal line of py_install
# if py_install isn't working then try adding the pip = TRUE argument to try installing
# the library through pip rather than anaconda
```

## Goals for this lab
Compute trust scores for the model's predictions of penguin species.
Practice working with Python in an R environment.


```{python}
import numpy as np
import trustscore # you need to have trustscore.py in the same folder as this .Rmd file to import it
import trustscore_evaluation  # you need to have trustscore_evaluation.py in the same folder as this .Rmd file to import it
import numpy as np
import matplotlib.pyplot as plt
import keras

# heads up! there might be some scary errors about "dlerror: cudart64_110.dll not found". It's just a warning and you can ignore it.

```

```{python}
# Import the default dataset from SK learn: the wine dataset and the classifying
# United States Post Office digits / handwriting.
from sklearn import datasets
wine = datasets.load_wine()
X_wine = wine.data
y_wine = wine.target
digits = datasets.load_digits()
X_digits = digits.data
y_digits = digits.target

datasets = [(X_wine, y_wine), (X_digits, y_digits)]
dataset_names = ["Wine", "Digits"]

```

```{python}

from sklearn.linear_model import LogisticRegression
# Train logistic regression on digits.
model = LogisticRegression()
model.fit(X_digits[:1300], y_digits[:1300])
# Get outputs on testing set.
y_pred = model.predict(X_digits[1300:])
# Initialize trust score.
trust_model = trustscore.TrustScore()
trust_model.fit(X_digits[:1300], y_digits[:1300])
# Compute trusts score, given (unlabeled) testing examples and (hard) model predictions.
trust_score = trust_model.get_score(X_digits[1300:], y_pred)

print(trust_score) # prints the trust scores for each point in the inputted dataset

# type(trust_score) # this trust_score dataframe has a class of <class 'numpy.ndarray'>

```

### Resources
Trust Scores functions from the Google Scholars paper: https://github.com/google/TrustScore
To Trust Or Not To Trust A Classifier paper by Heinrich Jiang, Been Kim, Melody Y. Guan, Maya Gupta: https://arxiv.org/abs/1805.11783
Reticulate documentation: https://rstudio.github.io/reticulate/
Stack Overflow failed to converge error answer, by 
Yahya and Peter Mortensen: https://stackoverflow.com/a/62659927

